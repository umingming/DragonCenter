-- 완성

--------------------------------------------------------------------------------------------------
-- B-6. 상담일지 작성 및 조회
--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 해당 교육생을 가르치는 교사는 교육생과 상담을 진행하여 그 내용을 기록 
--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 상담 작성 dml

INSERT INTO tblCounselLog(cl_seq, enrollment_seq, cl_date, cc_seq, cl_content) 
	values(11,1,to_date('21-12-01', 'yy-mm-dd'),3,'취업연계과정에 대한 번반적인 설명');





--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 상담 작성 procedure

CREATE OR REPLACE PROCEDURE procInsertCounselLog(
	penrollment_seq NUMBER,
	pcl_date DATE,
	pcc_seq NUMBER,
	pcl_content varchar2
)
IS
BEGIN 
	insert into tblCounselLog(cl_seq, enrollment_seq, cl_date, cc_seq, cl_content) 
		values(cl_seq.nextVal, penrollment_seq, pcl_date, pcc_seq, pcl_content);
END procInsertCounselLog;





--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 상담 작성 procedure 사용법

BEGIN
	procInsertCounselLog(3, to_date('21-12-02', 'yy-mm-dd'), 3, '임시');
END;





--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 상담 수정 dml

UPDATE tblCounselLog SET cl_content = '취업연계과정에 대한 전반적인 설명' WHERE cl_seq = 11;			





--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 상담 수정 procedure

CREATE OR REPLACE PROCEDURE procUpdateCounselLog(
	pcl_seq NUMBER,
	pcl_content varchar2
)
IS
BEGIN 
	UPDATE tblCounselLog SET cl_content = pcl_content WHERE cl_seq = pcl_seq;
EXCEPTION
	WHEN OTHERS THEN
		dbms_output.put_line('잘못된 번호 혹은 수정할 파일이 없습니다.');
END procUpdateCounselLog;





--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 상담 수정 procedure 사용법
BEGIN
	procUpdateCounselLog(310, '임시입니다.');
END;


--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 상담 삭제 dml

delete from tblCounselLog where cl_seq = 11;





--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 상담 삭제 procedure
CREATE OR REPLACE PROCEDURE procDeleteCounselLog(
	pcl_seq NUMBER
)
IS
BEGIN 
	DELETE FROM tblCounselLog WHERE cl_seq = pcl_seq;
EXCEPTION
	WHEN OTHERS THEN
		dbms_output.put_line('삭제할 정보가 없습니다');
END procDeleteCounselLog;




--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 상담 삭제 procedure 사용법
BEGIN
	procDeleteCounselLog(310);
END;


--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 카테고리 분류(취업, 진로, 학업)
--------------------------------------------------------------------------------------------------
SELECT 
	cc.cc_content,
	cl.cl_content 
FROM tblCounselcategory cc
	LEFT OUTER JOIN tblCounselLog cl ON cc.cc_seq = cl.cc_seq
		ORDER BY cc.cc_content;
-- 카테고리는 프로시저화 시키면 문장이 더 길어진다.







--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
-- 특정 과정, 교육생, 날짜별로 상담 기록 조회 가능
--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
SELECT * FROM vwcounseldate WHERE student_name = '김광연';





--------------------------------------------------------------------------------------------------




